
#ifndef _CAN_MESSAGE_H_
#define _CAN_MESSAGE_H_

#include <stdint.h>
#include <stdbool.h>
#include <linux/can.h>

#define CAN_SIG_PER_MESSAGE                 32
#define CAN_MESSAGE_PERIOD                  100         // 100 ms

typedef enum {
	CAN_MSG_REC_SET_WALK_IN,
	CAN_MSG_FAN_JIG_RESPOND,
	CAN_MSG_FAN_JIG_REQUEST,
	CAN_MSG_REC1_GROUP_ACK,
	CAN_MSG_REC0_GROUP_ACK,
	CAN_MSG_REC1_GROUP_SET_MSG,
	CAN_MSG_REC0_GROUP_SET_MSG,
	CAN_MSG_REC_ADDRESSING_MODE_MSG,
	CAN_MSG_CP1_MONITOR,
	CAN_MSG_CP1_INFOVERSION,
	CAN_MSG_CP0_INFOVERSION,
	CAN_MSG_IO_EXT_INFOVERSION,
	CAN_MSG_REC0_ON_OFF_REQUEST,
	CAN_MSG_REC0_OUTPUT_REQUEST,
	CAN_MSG_REC0_OUTPUT_INFO_REQUEST,
	CAN_MSG_REC0_OUTPUT_INFO_RESPONSE,
	CAN_MSG_REC0_ERROR_INFO_REQUEST,
	CAN_MSG_REC0_ERROR_INFO_RESPONSE,
	CAN_MSG_REC1_ON_OFF_REQUEST,
	CAN_MSG_REC1_OUTPUT_REQUEST,
	CAN_MSG_REC1_OUTPUT_INFO_REQUEST,
	CAN_MSG_REC1_OUTPUT_INFO_RESPONSE,
	CAN_MSG_REC1_ERROR_INFO_REQUEST,
	CAN_MSG_REC1_ERROR_INFO_RESPONSE,
	CAN_MSG_FAN_FAILDEM,
	CAN_MSG_FAN_TEMP_FAILDEM,
	CAN_MSG_FAN_INFO_GROUP0,
	CAN_MSG_FAN_INFO_GROUP1,
	CAN_MSG_FAN_TEMP_INFO,
	CAN_MSG_FAN_VERSION,
	CAN_MSG_FAN_SYSTEM_FAILDEM,
	CAN_MSG_REC0_OUTPUT_NOTIFY,
	CAN_MSG_REC1_OUTPUT_NOTIFY,
	CAN_MSG_SYSTEM_MODE,
	CAN_MSG_SYSTEM_OUTPUT_REQUEST,
	CAN_MSG_HV_ALERT_STATUS,
	CAN_MSG_HV_MONITOR,
	CAN_MSG_HV_VERSION,
	CAN_MSG_HEART_BEAT,
	CAN_MSG_CP0_MONITOR,
	CAN_MSG_MAX
} can_msg_id_t;

typedef enum {
	CAN_SIG_REC_WALK_IN_TIME,
	CAN_SIG_REC_WALK_IN_ENABLE,
	CAN_SIG_FAN_JIG_RES_DATA_VALUE2,
	CAN_SIG_FAN_JIG_RES_DATA_VALUE1,
	CAN_SIG_FAN_JIG_RES_DATA_LENGTH,
	CAN_SIG_FAN_JIG_RES_TARGET_ADDRESS,
	CAN_SIG_FAN_JIG_REQ_DATA_VALUE1,
	CAN_SIG_FAN_JIG_REQ_DATA_LENGTH,
	CAN_SIG_FAN_JIG_REQ_TARGET_ADDRESS,
	CAN_SIG_REC1_GROUP_CONFIRMED,
	CAN_SIG_REC0_GROUP_CONFIRMED,
	CAN_SIG_REC1_GROUP_NUMBER,
	CAN_SIG_REC0_GROUP_NUMBER,
	CAN_SIG_REC_ADDRESSING_MODE,
	CAN_SIG_MONITOR_PE1_LOST,
	CAN_SIG_MONITOR_CP1_LOST,
	CAN_SIG_CP1_APP_SUBMINOR,
	CAN_SIG_CP1_APP_MINOR,
	CAN_SIG_CP1_APP_MAJOR,
	CAN_SIG_CP0_APP_SUBMINOR,
	CAN_SIG_CP0_APP_MINOR,
	CAN_SIG_CP0_APP_MAJOR,
	CAN_SIG_AC_RELAY_STATUS,
	CAN_SIG_IO_VERSION_APP_MINOR,
	CAN_SIG_IO_VERSION_APP_MAJOR,
	CAN_SIG_IO_VERSION_APP_SUBMINOR,
	CAN_SIG_REC0_ON_OFF,
	CAN_SIG_REC0_VOLTAGE_REQUEST,
	CAN_SIG_REC0_CURRENT_REQUEST,
	CAN_SIG_REC0_CURRENT_PRESENT,
	CAN_SIG_REC0_VOLTAGE_PRESENT,
	CAN_SIG_REC0_TEMPERATURE,
	CAN_SIG_REC0_GROUP,
	CAN_SIG_REC0_STATE2_MDL_ID_REPETITION,
	CAN_SIG_REC0_STATE2_MDL_PFC_SIDE_OFF,
	CAN_SIG_REC0_STATE2_INPUT_OVER_VOLTAGE,
	CAN_SIG_REC0_STATE2_INPUT_UNDER_VOLTAGE,
	CAN_SIG_REC0_STATE2_INPUT_UNBALANCE,
	CAN_SIG_REC0_STATE2_INPUT_PHASE_LOST,
	CAN_SIG_REC0_STATE2_LOAD_UNSHARING,
	CAN_SIG_REC0_STATE2_POWER_LIMIT,
	CAN_SIG_REC0_STATE1_COMM_INTERRUPT,
	CAN_SIG_REC0_STATE1_WALK_IN_ENABLE,
	CAN_SIG_REC0_STATE1_OUTPUT_OVER_VOLTAGE,
	CAN_SIG_REC0_STATE1_OVER_TEMPERATURE,
	CAN_SIG_REC0_STATE1_FAN_FAULT,
	CAN_SIG_REC0_STATE1_MDL_PROTECTED,
	CAN_SIG_REC0_STATE1_MDL_FAULT,
	CAN_SIG_REC0_STATE1_MDL_OFF_STATE,
	CAN_SIG_REC0_STATE0_DISCHARGE_ABNORMAL,
	CAN_SIG_REC0_STATE0_PFC_SIDE_ABNORMAL,
	CAN_SIG_REC0_STATE0_INNER_COMM,
	CAN_SIG_REC0_STATE0_OUTPUT_SHORT,
	CAN_SIG_REC1_ON_OFF,
	CAN_SIG_REC1_VOLTAGE_REQUEST,
	CAN_SIG_REC1_CURRENT_REQUEST,
	CAN_SIG_REC1_CURRENT_PRESENT,
	CAN_SIG_REC1_VOLTAGE_PRESENT,
	CAN_SIG_REC1_TEMPERATURE,
	CAN_SIG_REC1_GROUP,
	CAN_SIG_REC1_STATE2_MDL_ID_REPETITION,
	CAN_SIG_REC1_STATE2_MDL_PFC_SIDE_OFF,
	CAN_SIG_REC1_STATE2_INPUT_OVER_VOLTAGE,
	CAN_SIG_REC1_STATE2_INPUT_UNDER_VOLTAGE,
	CAN_SIG_REC1_STATE2_INPUT_UNBALANCE,
	CAN_SIG_REC1_STATE2_INPUT_PHASE_LOST,
	CAN_SIG_REC1_STATE2_LOAD_UNSHARING,
	CAN_SIG_REC1_STATE2_POWER_LIMIT,
	CAN_SIG_REC1_STATE1_COMM_INTERRUPT,
	CAN_SIG_REC1_STATE1_WALK_IN_ENABLE,
	CAN_SIG_REC1_STATE1_OUTPUT_OVER_VOLTAGE,
	CAN_SIG_REC1_STATE1_OVER_TEMPERATURE,
	CAN_SIG_REC1_STATE1_FAN_FAULT,
	CAN_SIG_REC1_STATE1_MDL_PROTECTED,
	CAN_SIG_REC1_STATE1_MDL_FAULT,
	CAN_SIG_REC1_STATE1_MDL_OFF_STATE,
	CAN_SIG_REC1_STATE0_DISCHARGE_ABNORMAL,
	CAN_SIG_REC1_STATE0_PFC_SIDE_ABNORMAL,
	CAN_SIG_REC1_STATE0_INNER_COMM,
	CAN_SIG_REC1_STATE0_OUTPUT_SHORT,
	CAN_SIG_FAN7_FAILDEM,
	CAN_SIG_FAN6_FAILDEM,
	CAN_SIG_FAN5_FAILDEM,
	CAN_SIG_FAN4_FAILDEM,
	CAN_SIG_FAN3_FAILDEM,
	CAN_SIG_FAN2_FAILDEM,
	CAN_SIG_FAN1_FAILDEM,
	CAN_SIG_FAN0_FAILDEM,
	CAN_SIG_TEMP2_FAILDEM,
	CAN_SIG_TEMP1_FAILDEM,
	CAN_SIG_TEMP0_FAILDEM,
	CAN_SIG_FAN3_SPEED,
	CAN_SIG_FAN3_DUTY,
	CAN_SIG_FAN2_SPEED,
	CAN_SIG_FAN2_DUTY,
	CAN_SIG_FAN1_SPEED,
	CAN_SIG_FAN1_DUTY,
	CAN_SIG_FAN0_SPEED,
	CAN_SIG_FAN0_DUTY,
	CAN_SIG_FAN7_SPEED,
	CAN_SIG_FAN7_DUTY,
	CAN_SIG_FAN6_SPEED,
	CAN_SIG_FAN6_DUTY,
	CAN_SIG_FAN5_SPEED,
	CAN_SIG_FAN5_DUTY,
	CAN_SIG_FAN4_SPEED,
	CAN_SIG_FAN4_DUTY,
	CAN_SIG_TEMP2_INFO,
	CAN_SIG_TEMP1_INFO,
	CAN_SIG_TEMP0_INFO,
	CAN_SIG_FAN_HW_VERSION_SUBMINOR,
	CAN_SIG_FAN_HW_VERSION_MAJOR,
	CAN_SIG_FAN_VESION_BOOT_SUBMINOR,
	CAN_SIG_FAN_VERSION_BOOT_MINOR,
	CAN_SIG_FAN_VERSION_BOOT_MAJOR,
	CAN_SIG_FAN_VESION_APP_SUBMINOR,
	CAN_SIG_FAN_VERSION_APP_MINOR,
	CAN_SIG_FAN_VESION_APP_MAJOR,
	CAN_SIG_FAN_HW_VERSION_MINOR,
	CAN_SIG_FAN_SYSTEM2_FAILDEM_ALL_TEMPS,
	CAN_SIG_FAN_SYSTEM1_FAILDEM_ALL_TEMPS,
	CAN_SIG_FAN_SYSTEM2_COOLING_DONE,
	CAN_SIG_FAN_SYSTEM1_COOLING_DONE,
	CAN_SIG_FAN_SYSTEM2_OVER_TEMP,
	CAN_SIG_FAN_SYSTEM2_FAILDEM_ALL_FANS,
	CAN_SIG_FAN_SYSTEM1_OVER_TEMP,
	CAN_SIG_FAN_SYSTEM1_FAILDEM_ALL_FANS,
	CAN_SIG_REC0_CURRENT_NOTIFY,
	CAN_SIG_REC0_VOLTAGE_NOTIFY,
	CAN_SIG_REC1_VOLTAGE_NOTIFY,
	CAN_SIG_REC1_CURRENT_NOTIFY,
	CAN_SIG_AC_RELAY_REQUEST,
	CAN_SIG_SYSTEM_STATE,
	CAN_SIG_V2G1_STATE,
	CAN_SIG_V2G0_STATE,
	CAN_SIG_FAST_CHARGE,
	CAN_SIG_ACTIVE_OUTLET,
	CAN_SIG_DC1_VOLTAGE_MAX,
	CAN_SIG_DC0_VOLTAGE_MAX,
	CAN_SIG_DC1_VOLTAGE_REQUEST,
	CAN_SIG_DC0_VOLTAGE_REQUEST,
	CAN_SIG_HV_EXTMEM_FAIL,
	CAN_SIG_HV_SELFTEST_STATE,
	CAN_SIG_HV_AC_RELAY_STATUS,
	CAN_SIG_HV_OUTPUT_LV_RELAY_ERROR,
	CAN_SIG_HV_OUTPUT_HV_RELAY_ERROR,
	CAN_SIG_HV_OUTPUT_PRE_RELAY_ERROR,
	CAN_SIG_HV_OUTPUT1_LV_RELAY_ERROR,
	CAN_SIG_HV_OUTPUT1_HV_RELAY_ERROR,
	CAN_SIG_HV_OUTPUT1_PRE_RELAY_ERROR,
	CAN_SIG_HV_OUTPUT0_LV_RELAY_ERROR,
	CAN_SIG_HV_OUTPUT0_HV_RELAY_ERROR,
	CAN_SIG_HV_OUTPUT0_PRE_RELAY_ERROR,
	CAN_SIG_HV_OVERHEAT,
	CAN_SIG_HV_ISO_N1_ERROR,
	CAN_SIG_HV_ISO_P1_ERROR,
	CAN_SIG_HV_ISO_N0_ERROR,
	CAN_SIG_HV_ISO_P0_ERROR,
	CAN_SIG_HV_OUTPUT1_ABNORMAL,
	CAN_SIG_HV_OUTPUT1_UNDER_VOLTAGE,
	CAN_SIG_HV_OUTPUT1_OVER_VOLTAGE,
	CAN_SIG_HV_OUTPUT0_ABNORMAL,
	CAN_SIG_HV_OUTPUT0_UNDER_VOLTAGE,
	CAN_SIG_HV_OUTPUT0_OVER_VOLTAGE,
	CAN_SIG_HV_INPUT_UNDER_VOLTAGE,
	CAN_SIG_HV_INPUT_OVER_VOLTAGE,
	CAN_SIG_HV_STATUS1,
	CAN_SIG_HV_STATUS0,
	CAN_SIG_HV_CHARGER_MODE,
	CAN_SIG_DC1_PRECHARGE_RELAY,
	CAN_SIG_DC1_MAIN_RELAY,
	CAN_SIG_DC1_ISOLATION_STATUS,
	CAN_SIG_DC1_VOLTAGE_PRESENT,
	CAN_SIG_DC0_PRECHARGE_RELAY,
	CAN_SIG_DC0_MAIN_RELAY,
	CAN_SIG_DC0_ISOLATION_STATUS,
	CAN_SIG_DC0_VOLTAGE_PRESENT,
	CAN_SIG_HV_VERSION_BOOT_SUBMINOR,
	CAN_SIG_HV_VERSION_BOOT_MINOR,
	CAN_SIG_HV_VERSION_BOOT_MAJOR,
	CAN_SIG_HV_VERSION_APP_SUBMINOR,
	CAN_SIG_HV_VERSION_APP_MINOR,
	CAN_SIG_HV_VERSION_APP_MAJOR,
	CAN_SIG_SYSTEM_REBOOT,
	CAN_SIG_CONFIGURE_CHARGER_MODE,
	CAN_SIG_COMM_REQUEST_XMC1,
	CAN_SIG_COMM_REQUEST_XMC0,
	CAN_SIG_COMM_REQUEST_ROLL_COUNTER,
	CAN_SIG_COMM_REQUEST_EXT,
	CAN_SIG_COMM_REQUEST_HV,
	CAN_SIG_COMM_REQUEST_FAN,
	CAN_SIG_MONITOR_PE0_LOST,
	CAN_SIG_MONITOR_CP0_LOST,
	CAN_SIG_MAX
} can_sig_id_t;

typedef struct can_frame can_frame_t;

typedef enum {
    CAN_TX_MSG = 0,
    CAN_RX_MSG
} can_transfer_t;

typedef struct {
    uint16_t       bus_id;
    can_frame_t    frame;
    can_transfer_t type;
    uint16_t       period_ms;
    uint16_t       elapsed;
    bool           active;
    uint8_t        sig_cnt;
    can_sig_id_t   sig_tbl[CAN_SIG_PER_MESSAGE];
} can_msg_t;

typedef struct {
    can_msg_id_t msg_id;
    uint8_t      start;
    uint8_t      len;
} can_sig_t;

#endif //_CAN_MESSAGE_H_
